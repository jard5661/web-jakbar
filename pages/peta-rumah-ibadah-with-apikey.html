<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Rumah Ibadah Jakarta Barat - Monitoring Jakarta Barat</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="../libs/tailwind.css">

    <!-- Common Styles -->
    <link rel="stylesheet" href="../components/common-styles.css">

    <style>
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        thead th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background-color: #f9fafb;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        tbody td {
            padding: 1rem;
            font-size: 0.875rem;
            color: #374151;
        }

        tbody td.no-column {
            text-align: center;
            font-weight: 600;
            color: #6b7280;
        }

        /* Sheet Tabs */
        .sheet-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .sheet-tab {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .sheet-tab:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .sheet-tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #2563eb;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .pagination-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #3b82f6;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Search Box */
        .search-box {
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            thead th,
            tbody td {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
            }

            .sheet-tab {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navbar Container -->
    <div id="navbar-container"></div>

    <main class="container mx-auto px-4 py-8">
        <!-- Breadcrumb -->
        <div class="mb-6">
            <nav class="text-sm">
                <a href="../index.html" class="text-blue-600 hover:underline">Home</a>
                <span class="text-gray-500 mx-2">‚Ä∫</span>
                <span class="text-gray-900 font-semibold">Peta Rumah Ibadah</span>
            </nav>
        </div>

        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Data Rumah Ibadah Jakarta Barat</h2>
            <p class="text-gray-600">Data rumah ibadah per kecamatan di wilayah Jakarta Barat</p>
        </div>

        <!-- Sheet Tabs -->
        <div class="sheet-tabs" id="sheetTabs">
            <!-- Tabs will be generated by JavaScript -->
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <input type="text"
                   id="searchInput"
                   class="search-input"
                   placeholder="üîç Cari data...">
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p class="mt-4">Memuat data...</p>
            </div>

            <table id="dataTable" style="display: none;">
                <thead>
                    <tr id="tableHeader">
                        <!-- Headers will be generated by JavaScript -->
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="paginationContainer" style="display: none;">
            <div class="pagination-info" id="paginationInfo">
                <!-- Info will be generated by JavaScript -->
            </div>
            <div class="pagination-buttons" id="paginationButtons">
                <!-- Buttons will be generated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Components Script -->
    <script src="../components/components.js"></script>

    <!-- Table Script -->
    <script>
        // Configuration
        const SPREADSHEET_ID = '1iDRGZJ9lln72Ofoy27Y8eFkey6RcXt3bC1A1WaPFgG8';
        const API_KEY = 'YOUR_GOOGLE_API_KEY'; // Anda perlu Google API Key
        const ROWS_PER_PAGE = 10;

        // State
        let currentSheet = null;
        let currentPage = 1;
        let allData = [];
        let filteredData = [];
        let sheets = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSheetData();
            setupSearch();
        });

        // Load sheet data
        async function loadSheetData() {
            try {
                showLoading(true);

                // Get sheet names first
                const metaUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
                const metaResponse = await fetch(metaUrl);
                const metaData = await metaResponse.json();

                sheets = metaData.sheets.map(s => s.properties.title);

                // Generate sheet tabs
                generateSheetTabs();

                // Load first sheet
                if (sheets.length > 0) {
                    loadSheet(sheets[0]);
                }
            } catch (error) {
                console.error('Error loading sheets:', error);
                showError('Gagal memuat data. Pastikan Google API Key sudah diset.');
            }
        }

        // Generate sheet tabs
        function generateSheetTabs() {
            const tabsContainer = document.getElementById('sheetTabs');
            tabsContainer.innerHTML = sheets.map((sheet, index) =>
                `<button class="sheet-tab ${index === 0 ? 'active' : ''}"
                        onclick="loadSheet('${sheet}')">
                    ${sheet}
                </button>`
            ).join('');
        }

        // Load specific sheet
        async function loadSheet(sheetName) {
            try {
                showLoading(true);
                currentSheet = sheetName;
                currentPage = 1;

                // Update active tab
                document.querySelectorAll('.sheet-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.textContent.trim() === sheetName) {
                        tab.classList.add('active');
                    }
                });

                // Fetch sheet data
                const range = `${sheetName}!A:Z`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.values && data.values.length > 0) {
                    allData = data.values;
                    filteredData = allData;
                    renderTable();
                    showLoading(false);
                } else {
                    showError('Sheet kosong atau tidak ada data.');
                }
            } catch (error) {
                console.error('Error loading sheet:', error);
                showError('Gagal memuat sheet: ' + sheetName);
            }
        }

        // Render table
        function renderTable() {
            if (filteredData.length === 0) return;

            const headers = filteredData[0];
            const rows = filteredData.slice(1);

            // Render headers
            const headerHtml = headers.map(header =>
                `<th>${header}</th>`
            ).join('');
            document.getElementById('tableHeader').innerHTML = headerHtml;

            // Calculate pagination
            const totalPages = Math.ceil(rows.length / ROWS_PER_PAGE);
            const startIndex = (currentPage - 1) * ROWS_PER_PAGE;
            const endIndex = startIndex + ROWS_PER_PAGE;
            const pageRows = rows.slice(startIndex, endIndex);

            // Render rows
            const bodyHtml = pageRows.map((row, index) => {
                const rowHtml = headers.map((header, colIndex) => {
                    const value = row[colIndex] || '-';
                    const isNoColumn = colIndex === 0 && !isNaN(value);
                    return `<td class="${isNoColumn ? 'no-column' : ''}">${value}</td>`;
                }).join('');
                return `<tr>${rowHtml}</tr>`;
            }).join('');
            document.getElementById('tableBody').innerHTML = bodyHtml;

            // Render pagination
            renderPagination(rows.length, totalPages);

            // Show table
            document.getElementById('dataTable').style.display = 'table';
            document.getElementById('paginationContainer').style.display = 'flex';
        }

        // Render pagination
        function renderPagination(totalRows, totalPages) {
            const startRow = (currentPage - 1) * ROWS_PER_PAGE + 1;
            const endRow = Math.min(currentPage * ROWS_PER_PAGE, totalRows);

            // Info
            document.getElementById('paginationInfo').textContent =
                `Menampilkan ${startRow}-${endRow} dari ${totalRows} data`;

            // Buttons
            let buttonsHtml = '';

            // Previous button
            buttonsHtml += `
                <button class="pagination-btn"
                        onclick="changePage(${currentPage - 1})"
                        ${currentPage === 1 ? 'disabled' : ''}>
                    ‚Äπ Sebelumnya
                </button>
            `;

            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                buttonsHtml += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}"
                            onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }

            // Next button
            buttonsHtml += `
                <button class="pagination-btn"
                        onclick="changePage(${currentPage + 1})"
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    Selanjutnya ‚Ä∫
                </button>
            `;

            document.getElementById('paginationButtons').innerHTML = buttonsHtml;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil((filteredData.length - 1) / ROWS_PER_PAGE);
            if (page < 1 || page > totalPages) return;

            currentPage = page;
            renderTable();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Setup search
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;

            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.toLowerCase();

                    if (searchTerm === '') {
                        filteredData = allData;
                    } else {
                        const headers = allData[0];
                        const rows = allData.slice(1);

                        const filtered = rows.filter(row =>
                            row.some(cell =>
                                String(cell).toLowerCase().includes(searchTerm)
                            )
                        );

                        filteredData = [headers, ...filtered];
                    }

                    currentPage = 1;
                    renderTable();
                }, 300);
            });
        }

        // Show/hide loading
        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'block' : 'none';
            document.getElementById('dataTable').style.display = show ? 'none' : 'table';
            document.getElementById('paginationContainer').style.display = show ? 'none' : 'flex';
        }

        // Show error
        function showError(message) {
            showLoading(false);
            document.getElementById('loadingState').innerHTML = `
                <p class="text-red-600 font-semibold">‚ùå ${message}</p>
                <p class="mt-2 text-sm text-gray-600">
                    Pastikan Google API Key sudah diset dengan benar.
                </p>
            `;
        }
    </script>
</body>
</html>
